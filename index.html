<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="LvMin-Blog">
<meta property="og:url" content="blog.shenzihao.top/index.html">
<meta property="og:site_name" content="LvMin-Blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LvMin-Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="blog.shenzihao.top/">





  <title>LvMin-Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LvMin-Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">网络安全</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十八/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十八/" itemprop="url">网络基础十八</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:58:02+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-18防火墙的一般配置步骤"><a href="#1-18防火墙的一般配置步骤" class="headerlink" title="1.18防火墙的一般配置步骤"></a>1.18防火墙的一般配置步骤</h1><p>1.防火墙的一般配置步骤：</p>
<p>  （1）接口配置IP</p>
<p>  （2）解决路由问题：内网的和外网的</p>
<p>  （3）把接口划分到相应的区域里</p>
<p>  （4）写策略（ACL）</p>
<p>  （5）实现内网上网：NAT</p>
<p>2.让内网可以访问外网服务器：在WAN的web服务器上搭建DNS+web</p>
<p>  （1）先挂载光驱—我的电脑—点击光驱—安装可选的Windows组件—网络服务（DNS）—应用程序服务器（安装IIS）</p>
<p>3.把内网服务器发布到公网上</p>
<p>  （1）在内网服务器上搭建web服务器，<a href="http://www.lanou.com" target="_blank" rel="noopener">www.lanou.com</a></p>
<p>  （2）在防火墙上做DNAT，把100.1.1.1:80转换为172.16.1.1:80</p>
<p>  （3）写策略：允许任意的源访问————172.16.1.1:80</p>
<p>4.综合实验步骤说明：</p>
<p>  （1）先实现内网通信；</p>
<p>  （2）实现外网通信；</p>
<p>  （3）做NAT实现内网主机访问外网；===》实现上网</p>
<p>  （4）实现IpsecVPN；===》不同私网之间的通信</p>
<p>5.综合实验讲解</p>
<p>  （1）二层交换机划分vlan：</p>
<p>​          access：只能承载一个vlan，用于PC和交换机之间相连。</p>
<p>​       trunk：一条物理链路承载多个vlan，用于设备之间的连接。</p>
<p>​       vlan  10</p>
<p>​       vlan 20</p>
<p>​       int  f0/3</p>
<p>​       switchport   mode access </p>
<p>​       switchport   access  vlan  10</p>
<p>​       int f0/4</p>
<p>​       switchport   mode access </p>
<p>​       switchport   access  vlan  20</p>
<p>​       int range f0/1 - 2</p>
<p>​       switchport   mode trunk </p>
<p>​       </p>
<p>​       2L-1#show int trunk       //检查trunk</p>
<p>​        </p>
<p>​       2L-1#show vlan  brief   //查看接口和vlan是否对应</p>
<p>​        </p>
<p>  （2）不同vlan之间的通信问题————单臂路由（源目Ip地址不变，二层mac地址被重写，标签置换）和三层交换机（一次路由，多次交换）</p>
<p>​       三层交换机转发效率高：基于硬件做转发，基于数据流做转发。</p>
<p>​       3L-1(config)#int f0/3</p>
<p>​        3L-1(config-if)#switchport trunk encapsulation dot1q    //把交换机的接口做二层接口</p>
<p>​        3L-1(config-if)#switchport mode trunk </p>
<p>​    </p>
<p>​        做三层的以太链路捆绑：</p>
<p>​        3L-1(config)#int range f0/2,f0/4</p>
<p>​        3L-1(config-if-range)#channel-group 1 mode on</p>
<p>​        3L-1(config-if-range)#</p>
<p>​        3L-1(config)#int port-channel 1</p>
<p>​        3L-1(config-if)#no switchport </p>
<p>​        3L-1(config-if)#ip add 192.168.50.1 255.255.255.0</p>
<p>​        3L-1(config-if)#no sh</p>
<p>​        3L-1(config)#int f0/1    //三层交换机的上联接口是3层链路</p>
<p>​        3L-1(config-if)#no switchport </p>
<p>​        3L-1(config-if)#ip add 192.168.30.2 255.255.255.0</p>
<p>​        3L-1(config-if)#no sh</p>
<p>​        </p>
<p>​        3L-1作为vlan10的主，vlan20的备份；</p>
<p>​        interface Vlan10</p>
<p>​         ip address 192.168.10.200 255.255.255.0</p>
<p>​         standby version 2</p>
<p>​         standby 10 ip 192.168.10.254</p>
<p>​         standby 10 preempt</p>
<p>​         standby 10 priority 105</p>
<p>​         standby 10 track FastEthernet0/1</p>
<p>​         standby 10 track FastEthernet0/3</p>
<p>​        !</p>
<p>​        interface Vlan20</p>
<p>​         ip address 192.168.20.200 255.255.255.0</p>
<p>​         standby version 2</p>
<p>​         standby 20 ip 192.168.20.254</p>
<p>​        </p>
<p>​         standby 20 preempt</p>
<p>​         standby 20 track FastEthernet0/1</p>
<p>​         standby 20 track FastEthernet0/3</p>
<p>​        </p>
<p>​        3L-2的HSRP配置；</p>
<p>​        interface Vlan10</p>
<p>​         ip address 192.168.10.200 255.255.255.0</p>
<p>​         standby version 2</p>
<p>​         standby 10 ip 192.168.10.254</p>
<p>​         standby 10 preempt</p>
<p>​         standby 10 track FastEthernet0/1</p>
<p>​         standby 10 track FastEthernet0/3</p>
<p>​        !</p>
<p>​        interface Vlan20</p>
<p>​         ip address 192.168.20.200 255.255.255.0</p>
<p>​         standby version 2</p>
<p>​         standby 20 ip 192.168.20.254</p>
<p>​         standby 20 priority 105</p>
<p>​         standby 20 preempt</p>
<p>​         standby 20 track FastEthernet0/1</p>
<p>​         standby 20 track FastEthernet0/3</p>
<p>  （3）实现外网通信：</p>
<p>​         router  ospf  110              //运营商的路由器配置ospf;出口路由器默认路由指向ISP。</p>
<p>​         router-id  11.1.1.1</p>
<p>​         network  13.1.1.0  0.0.0.255 area 0</p>
<p>​         network  12.1.1.0  0.0.0.255 area 0</p>
<p>​         network  61.1.1.0  0.0.0.255 area 0 </p>
<p>  （4）在出口路由器配置NAT，实现内网主机的上网功能+————由于NAT流量优先，要在NAT流量里先拒绝VPN流量</p>
<p>​        ip nat inside source list 100 interface FastEthernet1/0 overload</p>
<p>​        access-list 100 deny ip 192.168.10.0 0.0.0.255 192.168.80.0 0.0.0.255</p>
<p>​        access-list 100 deny ip 192.168.10.0 0.0.0.255 192.168.90.0 0.0.0.255</p>
<p>​        access-list 100 deny ip 192.168.20.0 0.0.0.255 192.168.90.0 0.0.0.255</p>
<p>​        access-list 100 deny ip 192.168.20.0 0.0.0.255 192.168.80.0 0.0.0.255</p>
<p>​        access-list 100 permit ip 192.168.10.0 0.0.0.255 any</p>
<p>​        access-list 100 permit ip 192.168.20.0 0.0.0.255 any</p>
<p>  （5）IpsecVPN的配置：前提是先实现公网通信。</p>
<p>​        第一步：实现公网通信；</p>
<p>​        第二步：配置阶段1；</p>
<p>​        crypto isakmp policy 10</p>
<p>​         encr 3des</p>
<p>​         authentication pre-share</p>
<p>​         group 2</p>
<p>​         crypto isakmp key test.123 address 71.1.1.2</p>
<p>​        第三步：配置阶段2：</p>
<p>​        crypto ipsec transform-set Beijing esp-3des esp-sha-hmac</p>
<p>​        第四步：定义感兴趣流量；</p>
<p>​        access-list 110 permit ip 192.168.10.0 0.0.0.255 192.168.80.0 0.0.0.255</p>
<p>​        access-list 110 permit ip 192.168.10.0 0.0.0.255 192.168.90.0 0.0.0.255</p>
<p>​        access-list 110 permit ip 192.168.20.0 0.0.0.255 192.168.80.0 0.0.0.255</p>
<p>​        access-list 110 permit ip 192.168.20.0 0.0.0.255 192.168.90.0 0.0.0.255</p>
<p>​        第五步：定义map，把第二、3/4步绑定到一起；</p>
<p>​        crypto map BJ 10 ipsec-isakmp </p>
<p>​         set peer 71.1.1.2</p>
<p>​         set transform-set Beijing </p>
<p>​         match address 110</p>
<p>​        第六步：应用到接口</p>
<p>​        interface FastEthernet1/0</p>
<p>​         ip address 61.1.1.1 255.255.255.0</p>
<p>​         ip nat outside</p>
<p>​         duplex auto</p>
<p>​         speed auto</p>
<p>​         crypto map BJ</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十七/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十七/" itemprop="url">网络基础十七</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:57:53+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-17防火墙"><a href="#1-17防火墙" class="headerlink" title="1.17防火墙"></a>1.17防火墙</h1><p>1.常见的安全设备；</p>
<p>  （1）防火墙Firewall：实现区域隔离，实现对流量的控制</p>
<p>  （2）上网行为管理：对用户的上网行为进行控制和管理；</p>
<p>  （3）IDS：入侵检测系统，对进入内网的可疑流量进行检测和报警。==》门卫</p>
<p>  （4）IPS：入侵防御系统，一旦发现可疑流量就会立即进行阻断，并记录日志。===》警察。</p>
<p>  （5）WAF：Web Application Firewall，为服务器做攻击防护。</p>
<p>2.防火墙基本概念</p>
<p>​    吞吐量：在不丢包的情况下单位时间内通过的数据包数量 </p>
<p>​    时延：数据包第一个比特进入防火墙到最后一比特从防火墙输出的时间间隔 </p>
<p>​    丢包率：通过防火墙传送时所丢失数据包数量占所发送数据包的比率 </p>
<p>​    并发连接数：防火墙能够同时处理的点对点连接的最大数目 </p>
<p>​    新建连接数：在不丢包的情况下每秒可以建立的最大连接数</p>
<p>3.防火墙的分类：软件防火墙和硬件防火墙。</p>
<p>  （1）包过滤防火墙：可基于3层和4层数据做过滤。</p>
<p>​           优点：转发效率高，但是管理麻烦；不能基于应用层数据做过滤。</p>
<p>  （2）应用网关型防火墙：给用户所有的流量做代理，也叫做代理防火墙。</p>
<p>​           特点：可以基于应用层数据做过滤，但是效率比较低；当网络流量过大时，容易产生性能瓶 颈。</p>
<p>  （3）状态检测防火墙：可以基于数据访问的状态做记录（状态缓存），基于数据流做转发，后续报  </p>
<p>​           文直接查缓存信息。</p>
<p>​            特点：提高了转发效率，但是对应用层的数据检测不够深入。</p>
<p>  （4）DPI：Deep Packet Inspection深度包监测防火墙。</p>
<p>​          特点：可以高效的对应用层数据做监测。</p>
<p>4.防火墙的部署方式；</p>
<p>可以对数据做识别和控制</p>
<p>  （1）透明模式：把防火墙当交换机用，优点是对现有的网络改动最小；缺点就是不够安全。</p>
<p>  （2）路由模式：把防火墙当路由器用，优点是更加安全；但是对网络改动比较大。</p>
<p>  （3）混杂模式：把防火墙有些接口当二层接口使用；有些接口当三层接口使用。</p>
<p>只能对数据做识别，把日志发送给日志服务器。</p>
<p>  （4）旁路模式：在核心交换机上开启端口镜像，把流量复制一份发送给“防火墙/上网行为”，由防火</p>
<p>​       墙做流量识别，把日志发送出去。</p>
<p>5.防火墙实验步骤：</p>
<p>  （1）环境说明：</p>
<p>​           XP：模拟Inside区域—VMNET1—192.168.1.0/24(windows)</p>
<p>​       DMZ: 模拟内网的web服务器区域—VMNET2—172.16.1.0/24(server)</p>
<p>​       Outside：模拟外网服务器区域—VMNET3—100.1.1.0/24(server</p>
<p>  （2）准备多网卡的环境：</p>
<p>​        在VMware中添加多个虚拟网卡：编辑————虚拟网络适配器</p>
<p>​        在防火墙上，添加最少3块虚拟网卡，依次连接VMnet1、net2、net3.</p>
<p>​        XP：模拟Inside区域，192.168.1.1—VMNET1—192.168.1.254/24</p>
<p>​        DMZ: 模拟内网的web服务器区域,172.16.1.1—VMNET2—  172.16.1.254/24</p>
<p>​                Outside：模拟外网服务器区域，100.1.1.2—VMNET3— 100.1.1.1/24</p>
<p>  （3）在真机里开启VMNET1，并配置为192.168.1.0/24网段，测试网络连通性，并使用web界面来</p>
<p>​            登录防火墙。</p>
<p>​        <a href="https://192.168.1.254:8080/" target="_blank" rel="noopener">https://192.168.1.254:8080/</a></p>
<p>​        superman / talent</p>
<p>​        </p>
<p>​        </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十六/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十六/" itemprop="url">网络基础十六</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:57:44+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-16IpsecVPN"><a href="#1-16IpsecVPN" class="headerlink" title="1.16IpsecVPN"></a>1.16IpsecVPN</h1><p>1.VPN：Virtaul Private  Network虚拟私有网络，实现内网之间的通信。</p>
<p>  私网之间的通信方式：</p>
<p>​        专线，安全性高，但是成本比较高;</p>
<p>​        租用链路；</p>
<p>​        VPN        </p>
<p>2.网络安全的方面：</p>
<p>  （1）数据被窃听：保障数据的机密性，</p>
<p>  （2）被篡改；保障数据的完整性，</p>
<p>  （3）防重放：给每个数据一个编号Sequence，</p>
<p>  （4）源认证；保障数据的发送和接收方都是合法的，</p>
<p>3.常见的算法</p>
<p>  （1）对称加密：加密和解密用的是同一把钥匙（算法）</p>
<p>​           常见的对称加密算法：DES、3DES、AES</p>
<p>​           特点：速度快，但是存在被窃听的危险。</p>
<p>  （2）非对称加密：加密和解密用的不是一把钥匙，是一个秘钥对————公钥和私钥。</p>
<p>​           基本传输方式：用公钥进行加密，用私钥来进行解密。</p>
<p>​           非对称加密算法：DH算法和RSA（证书）</p>
<p>​           特点：速度慢，但是更安全。</p>
<p>  （3）哈希算法：校验数据的完整性，防止被篡改。</p>
<p>​            常见算法：md5/sha/Hmac</p>
<p>4.IpsecVPN：</p>
<p>  协商分为2个阶段：</p>
<p>  第一阶段用来协商秘钥的安全性；使用的是isakmp协议叫做互联网秘钥交互协议。</p>
<p>  第二阶段是用来保证数据的安全性。</p>
<p>  （1）第一步：先实现公网通信。</p>
<p>​       ip  route  0.0.0.0   0.0.0.0  12.1.1.2</p>
<p>  （2）第二步：定义第一阶段，密码和密码的加密方式等</p>
<p>​       R1(config)#crypto isakmp policy 10        //定义第一阶段的策略，编号为10</p>
<p>​       R1(config-isakmp)#authentication pre-share   //认证方式为预共享密码</p>
<p>​       R1(config-isakmp)#encryption 3des           //加密方式为3des</p>
<p>​       R1(config-isakmp)#hash    sha              //保证数据完整性，用的是sha</p>
<p>​       R1(config-isakmp)#group 2            //使用非对称加密算法对秘钥进行二次加密</p>
<p>​       R1(config)#crypto isakmp key test.123 address 45.1.1.2   //定义密码为test.123，指定对端</p>
<p>​       的公网地址45.1.1.2</p>
<p>  （3）第三步：定义第二阶段，保证数据的安全性</p>
<p>​       R1(config)#crypto ipsec transform-set SET esp-3des esp-sha-hmac   //定义转换集，保证数</p>
<p>​       据安全性，3des是用来加密的；sha是用来保证完整性的</p>
<p>​       R1(cfg-crypto-trans)#mode tunnel         //设置传输模式为隧道模式，默认配置</p>
<p>  （4）第四步：定义感兴趣流量（对哪些流量进行加密，只有定义的感兴趣流量之间才能通信）       </p>
<p>​       R1(config)#access-list 100 permit ip host 192.168.1.1 host 192.168.2.1   //允许192.168.1.1</p>
<p>​        和192.168.2.1之间通信</p>
<p>  （5）第五步：把第2/3/4步绑到一起</p>
<p>​       R1(config)#crypto map VPN 10 ipsec-isakmp   //定义一个策略图，名称叫VPN，编号是10</p>
<p>​       R1(config-crypto-map)#match address 100         //匹配感兴趣流量</p>
<p>​       R1(config-crypto-map)#set peer 45.1.1.2            //设置对端公网地址45.1.1.2</p>
<p>​       R1(config-crypto-map)#set transform-set SET     //匹配转换集</p>
<p>​       R1(config-crypto-map)#exit</p>
<p>  （6）第六步：应用到接口</p>
<p>​        R1(config)#int f0/1</p>
<p>​        R1(config-if)#crypto map VPN </p>
<p>  （7）检查命令：</p>
<p>​        R1#show crypto engine connections active  //查看加密和解密的数据包    </p>
<p>  （8）后续需求：</p>
<p>​        实现PC2和PC4之间的通信，修改ACL</p>
<p>​        R1(config)#access-list 100 permit ip host 192.168.1.2 host 192.168.2.2   同时也要在对端添</p>
<p>​         加 </p>
<p>  （9）实现NAT</p>
<p>​       //在  NAT流量里拒绝VPN流量，允许其他  </p>
<p>​       R1(config)#access-list 110 deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255        </p>
<p>​       R1(config)#access-list 110 permit ip 192.168.1.0 0.0.0.255 any</p>
<p>​       R1(config)#ip nat inside source list 110 interface f0/1 overload    //做NAT转换</p>
<p>  （10）检查命令：  </p>
<p>​       R1#show crypto isakmp policy        //查看一阶段的策略</p>
<p>​       R1#show crypto isakmp sa         //SA叫做安全关联，是两个路由器协商完成后的策略存储方</p>
<p>​        式</p>
<p>​        IPv4 Crypto ISAKMP SA</p>
<p>​        dst             src             state          conn-id status       //Status状态是Active表示可用</p>
<p>​        45.1.1.2        12.1.1.1        QM_IDLE           1001 ACTIVE</p>
<p>​        </p>
<p>​      R5#show  crypto isakmp key     //一阶段，查看秘钥</p>
<p>​      Keyring      Hostname/Address                            Preshared Key</p>
<p>​      default      12.1.1.1                                    test.123</p>
<p>​      R5#show crypto ipsec transform-set       //检查第二阶段的转换集（保证数据的可靠性）</p>
<p>​      Transform set default: { esp-aes esp-sha-hmac  }    //default，默认策略</p>
<p>​      will negotiate = { Transport,  }, </p>
<p>​    </p>
<p>​    Transform set shanghai: { esp-3des esp-sha-hmac  }   //自定义的shanghai策略</p>
<p>​      will negotiate = { Tunnel,  }, </p>
<p>​      R5#show crypto ipsec sa    //查看第二阶段的sa（协商成功后的策略）</p>
<p>​         </p>
<p>​      R5#show crypto map    //查看map的内容</p>
<pre><code>Crypto Map IPv4 &quot;SH&quot; 10 ipsec-isakmp              //map名字叫SH，编号为10 </code></pre><p>​                Peer = 12.1.1.1                //对端的公网Ip</p>
<p>​                Extended IP access list 100            //感兴趣流量</p>
<p>​                access-list 100 permit ip host 192.168.2.1 host 192.168.1.1</p>
<p>​                access-list 100 permit ip host 192.168.2.2 host 192.168.1.2</p>
<p>​                Current peer: 12.1.1.1</p>
<p>​                Security association lifetime: 4608000 kilobytes/3600 seconds</p>
<p>​                Responder-Only (Y/N): N</p>
<p>​                PFS (Y/N): N</p>
<p>​               Transform sets={             //第二阶段的转换集</p>
<p>​               shanghai:  { esp-3des esp-sha-hmac  } , </p>
<p>​                 }</p>
<p>​      </p>
<p>​                Interfaces using crypto map SH:   //map应用的接口</p>
<p>​                FastEthernet0/0            </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十五/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十五/" itemprop="url">网络基础十五</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:57:35+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-15OSPF"><a href="#1-15OSPF" class="headerlink" title="1.15OSPF"></a>1.15OSPF</h1><p>1.路由协议分类：</p>
<p>  动态和静态</p>
<p>​      AS：自治系统，根据路由协议是否工作在一个AS中，把路由协议分为IGP和EGP。（  划分AS  </p>
<p>​               的原因：不同的路由协议有一个极限值；方便管理。）</p>
<p>​      IGP：内部网关协议，同一个AS内部使用；</p>
<p>​      EGP：外网网关协议，不同的AS之间通信。代表BGP。</p>
<p>​      动态路由协议：</p>
<p>​      距离矢量路由协议:rip,每个路由器没有全网拓扑，只能从邻居收到路由信息。（适用于小型</p>
<p>​                网络）</p>
<p>​        链路状态路由协议:ospf，is-is每个路由器都有全网拓扑，自己根据自己的数据库计算出来</p>
<p>​                最优路径。</p>
<p>2.OSPF的基本概念：是链路状态路由协议的典型代表，是公有协议；适用于大中型网络。</p>
<p>  （1）OSPF（Open Shortest  Path First）开放式最短路径优先，每个路由器以自己为根会计算出来  </p>
<p>​           一个“无环”的最优路径。</p>
<p>​           组播地址：224.0.0.5和224.0.0.6</p>
<p>​           ospf的管理距离（优先级）是110；rip的管理距离是120；</p>
<p>​          hello时间是10s；dead时间是40s；</p>
<p>​          更新：组播更新；</p>
<p>​          支持VLSM（支持无类的路由协议）；</p>
<p>​          支持认证；</p>
<p>​          支持区域划分；</p>
<p>  （2）OSPF的度量值为COST，参考带宽是100M。</p>
<p>​            COST= 108/BW（b/s）</p>
<p>​        最短路径是基于接口指定的代价（cost）计算的</p>
<p>  （3）LSDB：链路状态数据库；</p>
<p>​             LSA：链路状态通告（基本信息）  </p>
<p>  （4）Router-id：路由器唯一标识，用来标识每个路由器的身份。</p>
<p>​           选举规则：</p>
<p>​           手工指定的优先级最高；</p>
<p>​           回还口IP地址最大；</p>
<p>​           物理接口Ip地址最大；</p>
<p>3.OSPf中有3张表</p>
<p>  （1）邻居表：通过发送hello，寻找网络中的其他邻居。</p>
<p>  （2）链路状态数据库（LSDB：link State  Database）：交互LSA，形成LSDB。</p>
<p>​            LSA（Link State Advertisement）：链路状态通告（路由的基本信息），描述每个路由器的基</p>
<p>​            本接口信息、网络类型和IP地址等。</p>
<p>  （3）路由表：使用的是SPF算法，根据LSDB中的信息计算最优路由。  </p>
<p>5.OSPF的5种包：</p>
<p>  （1）hello：发送hello，建立和维持邻居关系。</p>
<p>  （2）DBD：Database Description数据库描述，类似于菜单/目录。</p>
<p>  （3）LSR：Link State Request，链路状态请求，请求自己没有的LSA条目。===》点你喜欢吃的</p>
<p>​           菜。</p>
<p>  （4）LSU：Link State Update，链路状态更新，响应LSR。=====》服务员给你确认一下菜单</p>
<p>  （5）LSACK：Link State Acknowledge，链路状态确认，响应LSR和LSU。    </p>
<p>   说明：LSA不是一种数据包，而是数据包里的条目。（菜单里的某个菜名） </p>
<p>7.OSPF的7种状态机：</p>
<h2 id="邻居关系：只交互Hello"><a href="#邻居关系：只交互Hello" class="headerlink" title="邻居关系：只交互Hello"></a>邻居关系：只交互Hello</h2><p>  （1）Down状态：开始发送hello，但是没有发现网络中有任何其他路由器；或者接口直接处于故障</p>
<p>​           状态。</p>
<p>  （2）Init状态：从邻居收到了hello包，但是hello包中没有自己的Router-id。建立了单向的邻居关</p>
<p>​           系。</p>
<p>  （3）2-Way状态：从邻居收到的hello里，包含了自己的Router-id。</p>
<h2 id="邻接关系：交互LSA"><a href="#邻接关系：交互LSA" class="headerlink" title="邻接关系：交互LSA"></a>邻接关系：交互LSA</h2><p>  （4）Exstart状态：交互DBD报文，用于选举主从（为了决定哪个路由器先发送DBD报文；一般只有</p>
<p>​           3个包左右）</p>
<p>  （5）Exchange；大量的DBD报文开始交互。====》翻菜单</p>
<p>  （6）Loading：交互LSR、LSU、LSACK。====》LSR（你点菜），LSU（点菜宝），LSACK（报</p>
<p>​          全部的菜名）</p>
<p>  （7）Full：交互完成===》菜齐了。</p>
<p>  8.ospf中划分区域的意义</p>
<p>  （1）防止过多的LSA对硬件资源的消耗；</p>
<p>  （2）在大型网络中，如果一条链路发生故障，会导致全网进行收敛。</p>
<p>  （3）解决方法：进行区域划分</p>
<p>​       区域ID：区域唯一标识，可以用十进制数表示；也可以用IP地址的形式表示。</p>
<p>​       区域分为2大类：</p>
<p>​       骨干区域，只有一个编号，就是area 0；非骨干区域之间通信，必须要经过骨干区域。</p>
<p>​       非骨干区域，编号是任何的非0的区域。</p>
<p>  9.ospf的基本配置：</p>
<p>  （1）基本配置：</p>
<p>​     router ospf 110    //110表示ospf的进程号，本地有效；不会影响邻居建立</p>
<p>​     router-id 22.1.1.1        //指定路由器的唯一标识：Router-id </p>
<p>​     network 22.1.1.0 0.0.0.255 area 0   //宣告自己的直连网段+反掩码（必须是连续的0或1）+区</p>
<p>​     域ID</p>
<p>​     network 23.1.1.0 0.0.0.255 area 0</p>
<p>  （2）3张表：</p>
<p>​     R2#show ip ospf neighbor    //邻居关系表</p>
<p>​    邻居的Router-id    优先级  状态，full邻接  死亡时间    邻居的接口Ip   自己和邻接相连的接口</p>
<p>​    Neighbor ID         Pri           State           Dead Time   Address         Interface</p>
<p>​    33.1.1.1              1           FULL/DR         00:00:30    23.1.1.2        FastEthernet0/1</p>
<p>  R2#show ip ospf database    //查看链路状态数据库</p>
<p>  R2#show ip route    //如果是o开头的（域内路由）表示从同一个区域学到的路由条目；</p>
<p>  //如果是O IA（域间路由）表示从其他区域学到的路由。</p>
<p>  O        34.1.1.0 [110/2] via 23.1.1.2, 00:01:28, FastEthernet0/1</p>
<p>​      44.0.0.0/32 is subnetted, 1 subnets</p>
<p>  O        44.1.1.1 [110/3] via 23.1.1.2, 00:01:28, FastEthernet0/1</p>
<p>​      45.0.0.0/24 is subnetted, 1 subnets</p>
<p>  O IA     45.1.1.0 [110/3] via 23.1.1.2, 00:01:28, FastEthernet0/1</p>
<p>​      55.0.0.0/32 is subnetted, 1 subnets</p>
<p>  O IA     55.1.1.1 [110/4] via 23.1.1.2, 00:01:28, FastEthernet0/1</p>
<p>10.OSPF中的网络类型：</p>
<p>  point to Point：点到点，代表接口是Serial口</p>
<p>  Broadcast Multi Access：广播型多路访问，代表接口是g0/0,f0/0,e0/0</p>
<p>11.在MA网络中，为了避免过多的邻接关系和重复的路由信息传递，要在MA网络中选举DR和BDR。</p>
<p>  （1）DR和BDR的选举依据：DR和BDR是基于接口的概念。一个路由器的不同接口可能属于不同的角色。</p>
<p>​       先比较优先级；优先级范围是0～255，数值越大，优先级越高，默认为1</p>
<p>​       比较Router-id（手工指定；回还口最大；物理接口Ip地址最大；）</p>
<p>​       说明：如果接口的优先级为0，就表示这个接口不参与DR/BDR的选举；==》DRother。       </p>
<p>  （2）关系：</p>
<p>​       DR和BDR之间：邻接关系====》Full（邻接关系表示交互LSA，可以交互路由条目==》交作业）</p>
<p>​       DR/BDR与DRother之间：邻接关系====》Full</p>
<p>​       DRother之间：邻居关系====》2-way状态（只交互hello，不交互路由信息）</p>
<p>  （3）DR和BDR一旦选举完成，不具备“抢占性”====》为了保证网络的稳定性。</p>
<p>​       如果DR  Down掉，由BDR接替DR的工作；</p>
<p>​       继续在DRother中选举一个BDR；</p>
<p>​       如果原始的DR即便恢复正常，也只能当DRother；</p>
<p>  （4）选举期：在MA网络中，选举时间是40s；在选举期内正常根据选举依据进行选举；</p>
<p>​       一旦选举完成，就不能再更改====》非选举期内，不再选举。</p>
<p>  （5）调整接口优先级：</p>
<p>​       R8(config)#int f0/0</p>
<p>​       R8(config-if)#ip ospf priority 100  </p>
<p>  （6）DRother监听组播地址224.0.0.5</p>
<p>​       DR、BDR监听2个组播地址224.0.0.5和224.0.0.6；</p>
<p>​       当DRother想把路由信息传递给DR/BDR时，目标地址是224.0.0.6（上交）</p>
<p>​       当DR、BDR通告路由信息的时候，目标地址是224.0.0.5（下发）</p>
<p>  （7）清除ospf进程的命令：</p>
<p>​       clear  ip ospf  process  ===&gt;输入yes；</p>
<p>​       </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十四/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十四/" itemprop="url">网络基础十四</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:57:19+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-14RIP"><a href="#1-14RIP" class="headerlink" title="1.14RIP"></a>1.14RIP</h1><p>1.路由协议：静态路由和动态路由</p>
<p>​    静态路由的特点：优先级比较高，但是配置麻烦，不能自动适应拓扑改变。</p>
<p>​    动态路由的特点：管理员手工告诉路由器之间使用什么语言（协议）进行交流，路由器之间自动进行路由条目的学习；还能自动适应拓扑变化。</p>
<p>​    动态路由协议的分类：</p>
<p>​    距离矢量路由协议：路由器没有全网拓扑，只是从邻居学到的路由（“道听途说”）—路标。</p>
<p>​                 代表：RIP（公有）、eigrp（Cisco私有）</p>
<p>​    链路状态路由协议：路由器上都有全网拓扑，会根据拓扑情况计算最优路径放到路由表中—地图    </p>
<p>​                 代表：OSPF、IS-IS                 </p>
<p>2.路由相关概念：</p>
<p>  AD：管理距离，也叫做优先级。范围是0——255，越小越优先。C：最优的；其次是S优先级为1.</p>
<p>  度量值：路由器把最优路径放到路由表中的“判断依据”，常见的度量值；跳数、带宽、成本（cost）</p>
<p>  收敛：（从发送hello包开始）使所有路由表都达到一致状态的过程</p>
<p>3.RIP的特点：</p>
<p>  属于距离矢量路由协议的典型代表；管理距离（AD，优先级）默认是120.</p>
<p>  RIp使用的是UDP协议来承载路由条目，端口号是udp-520</p>
<p>  更新方式：定期更新（每隔30s更新一次）、广播更新、全路由表更新。</p>
<p>  RIp是以跳数为度量值（metric），最大跳数是15，如果跳数为16，认为不可达。</p>
<p>  RIPv1在更新路由的时候，不携带子网掩码===》只能支持有类的路由条目</p>
<p>  RIPv2是无类的路由协议，更新的时候携带子网掩码。使用的组播更新，组播地址是224.0.0.9.   </p>
<p>4.RIP的环路问题</p>
<p>5.RIp的基本配置：</p>
<p>  （1）配置：</p>
<p>​    配置IP；配置rip；测试回还口是否通信；</p>
<p>​    在R1上启动一个回还口44.2.2.2/24；发现在R2上只能ping通44.2.2.2，不能ping通44.1.1.1====》  </p>
<p>​    R1上优先选择自己的回还口。</p>
<p>​    router rip</p>
<p>​    network 11.0.0.0</p>
<p>​    network 12.0.0.0</p>
<p>​    network 15.0.0.0</p>
<p>​    查看路由协议的属性：</p>
<p>​    show ip protocols   </p>
<p>​    清空路由表的命令：clear  ip  route  * </p>
<p> （2）查看路由表； </p>
<p>​    R1#show ip route    [120是管理距离；2表示metric度量值——跳数]</p>
<p>​    R     44.0.0.0/8 [120/2] via 15.1.1.2, 00:00:16, FastEthernet0/1</p>
<p>​    R     45.0.0.0/8 [120/1] via 15.1.1.2, 00:00:16, FastEthernet0/1</p>
<p>​    R     55.0.0.0/8 [120/1] via 15.1.1.2, 00:00:16, FastEthernet0/1</p>
<p>  （3）RIpv2的配置；</p>
<p>​    router  rip  </p>
<p>​    version  2        //使用rip版本2</p>
<p>​    network  12.1.1.0     //宣告自己的直连网段</p>
<p>​    no  auto-summary     //关闭自动汇总后，更新的时候携带子网掩码；会自动把无类的路由为有类的</p>
<p>​    路由进行通告；</p>
<p>​    </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十三/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十三/" itemprop="url">网络基础十三</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:57:08+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-13NAT详解"><a href="#1-13NAT详解" class="headerlink" title="1.13NAT详解"></a>1.13NAT详解</h1><p>1.NAT的用途分为：</p>
<p>  源SNAT：当内网访问外网的时候，经过路由器，会把源地址中的私网地址转换为公有地址，</p>
<p>​                  SNAT。</p>
<p> 目的：实现上网。</p>
<p>  目的DNAT：当外网访问内网服务器的时候，经过（服务器端的）路由器的时候，会把目标公网地址</p>
<p>  转换为服务器的真实私网IP，DNAT。</p>
<p>​          目的：服务器发布，可以通过公网来访问，对外开放一些常用端口（web-tcp80;dns-</p>
<p>  udp53）。</p>
<p>​          发布服务器的两种方案：</p>
<p>​          方案一：直接重新申请一个公网IP给服务器使用。================-===》静态NAT</p>
<p>​          方法二：在路由器的公网口的Ip上，开放某个端口，作为服务器的端口映射。===》端口</p>
<p> 映射        </p>
<p>2.按照NAT的实现方式；</p>
<p>  （1）静态NAT：一对一，一个私网ip对应一个公网ip。</p>
<p>​                应用：当某一个服务器需要对外发布的时候。</p>
<p>  （2）动态NAT：多对多，多个私网Ip对应多个公网ip。</p>
<p>​                 应用：服务器集群使用。</p>
<p>  （3）PAT（端口多路复用）：多对一，多个私网IP对应一个公网ip。</p>
<p>​                 应用：常见的家庭网、企业网、园区网等用的比较多。</p>
<p>3.PAT配置举例：</p>
<p>​    R1(config)#int f0/1             //配置内网接口  （如果是单臂路由，进入子接口int f0/0.10）</p>
<p>​    R1(config-if)#ip nat outside </p>
<p>​    R1(config-if)#int f0/0         //配置外网接口</p>
<p>​    R1(config-if)#ip nat inside </p>
<p>​    R1(config-if)#exit</p>
<p>​    R1(config)#access-list 10 permit host 192.168.1.1(标准访问控制列表是1–99，基于源IP)</p>
<p>​    R1(config)#access-list 10 permit host 192.168.1.2（扩展访问控制列表的访问控制列表号是  </p>
<p>​        100～199 ）</p>
<p>​    R1(config)#ip nat inside source list 10 interface f0/1 overload //把私网地址转换为公网地址</p>
<p>4.静态NAT：一对一 ；始终存在。</p>
<p>​    R1(config)#int f0/1</p>
<p>​    R1(config-if)#ip nat outside </p>
<p>​    R1(config-if)#int f0/0   （如果是单臂路由，进入子接口int f0/0.10）</p>
<p>​    R1(config-if)#ip nat inside </p>
<p>​    R1(config-if)#exit</p>
<p>​    R1(config)#ip nat inside source static 192.168.1.3 12.1.1.10  </p>
<p>5.动态NAT：多对多 </p>
<p>​    第一步：声明内网网接口</p>
<p>​    R1(config)#int f0/1</p>
<p>​    R1(config-if)#ip nat outside </p>
<p>​    R1(config-if)#int f0/0</p>
<p>​    R1(config-if)#ip nat inside </p>
<p>​    R1(config-if)#exit</p>
<p>​    第二步：定义需要做动态转换的服务器私网Ip</p>
<p>​    R4(config)#access-list 20 permit host 192.168.2.3</p>
<p>​    R4(config)#access-list 20 permit host 192.168.2.4</p>
<p>​    R4(config)#access-list 20 permit host 192.168.2.5</p>
<p>​    R4(config)#access-list 20 permit host 192.168.2.6</p>
<p>​    第三步：定义一个公网地址池，名字叫Server，开启IP是34.1.1.10，结束ip是34.1.1.13，子网掩码是255.255.255.0</p>
<p>​    R4(config)#ip nat pool Server 34.1.1.10 34.1.1.13 netmask 255.255.255.0</p>
<p>​    第四步：把定义的NAT转换到公网地址池Server中</p>
<p>​    R4(config)#ip nat inside source list 20 pool Server </p>
<p>6.目的NAT的实现方式；让外网的客户端能访问内网服务器。</p>
<p>​    方案一：直接重新申请一个公网IP给服务器使用。===》静态NAT</p>
<p>​    方法二：在路由器的公网口的Ip上，开放某个端口，作为服务器的端口映射。===》端口映射</p>
<p>​        配置端口映射：内网IP是192.168.1.3的TCP-80（web服务）到公网接口的12.1.1.1:80</p>
<p>​        R1(config)#ip nat inside source static tcp 192.168.1.3 80 12.1.1.1 80    </p>
<p>​        配置端口映射：内网ip是192.168.1.3的DNS服务器（udp-53），映射后的公网 ip12.1.1.1:53</p>
<p>​        R1(config)#ip nat inside source static udp 192.168.1.3 53 12.1.1.1 53</p>
<p>​    </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十二/" itemprop="url">网络基础十二</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:56:59+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-12ACL和NAT及ftp主被动模式"><a href="#1-12ACL和NAT及ftp主被动模式" class="headerlink" title="1.12ACL和NAT及ftp主被动模式"></a>1.12ACL和NAT及ftp主被动模式</h1><p>1.子网划分：</p>
<p>  使用200.1.1.0/24在一条链路上，只使用2个IP，最佳的方案是怎么做？</p>
<p>  2的m次方-2  &gt;=2    =====&gt; m&gt;=2（子网中0的个数）</p>
<p>  255.255.255.111111  00  ====&gt;  255.255.255.252</p>
<p>（1）以太网链路上的二层封装：EthernetII和802.3</p>
<p>​     在以太链路上，子网掩码最多是30位。</p>
<p>  (2）在公网上的二层封装是PPP（支持认证，标准协议），很多家庭用户接入使用的都是PPPOE拨</p>
<p>​     号上网，只有用户名和密码都匹配完成才能上网。    </p>
<p>​    如果在Serial串口链路上，子网最多可以是31位。</p>
<p>​    在串行链路上，分为DCE和DTE</p>
<p>​    DCE是data communicate equipment的意思，即数据通信设备,是ISP端，负责给客户端分配带</p>
<p>​     宽。</p>
<p>​    DTE是data terminal equipment的意思，即数据终端设备，是客户端。</p>
<p>​    ISP端，需要给客户端分配带宽</p>
<p>​    int  s0/2/0   (串口链路，此端口增加接口 WIC-2T)</p>
<p>​    encapsulation  ppp     //设置接口封装格式为PPP</p>
<p>​    ip  add  200.1.1.2   255.255.255.252    //配置接口IP</p>
<p>​    clock  rate  2000000    //给客户端指定带宽是2M</p>
<p>​    no  sh</p>
<p>​    客户端：</p>
<p>​    interface Serial0/3/0</p>
<p>​        ip address 200.1.1.1 255.255.255.252</p>
<p>​    encapsulation ppp</p>
<p>​    no sh       </p>
<p>（3）如果是回还口做测试，子网掩码最多是32位。</p>
<p>​        <strong>***</strong>扩展： 配置回环口：</p>
<p>​                            interface Loopback0</p>
<p>​                            ip address 11.1.1.1 255.255.255.0</p>
<p>1.扩展ACL：可以基于源目Ip、源目端口、协议来对数据流量做过滤。（编号100–199）</p>
<p>​    举例1；定义一个ACL，编号为101，拒绝192.168.1.0/24 到达 192.168.2.2 的FTP服务</p>
<p>​    Router(config)# access-list 101 deny tcp 192.168.1.0 0.0.0.255 host 192.168.2.2 eq 21   </p>
<p>​    举例2：定义ACL101，拒绝192.168.1.0/24访问192.168.2.2的ICMP服务</p>
<p>​    Router(config)# access-list  101  deny  icmp  192.168.1.0  0.0.0.255  host  192.168.2.2  </p>
<p>​    举例3：允许或拒绝所有流量</p>
<p>​    Router(config)# access-list 101 permit ip any any   //第一个any是源，第二个any是目标</p>
<p>2.实验举例：</p>
<p>​    R2(config)#access-list 100 permit tcp host 192.168.1.1 host 192.168.2.3 eq 80</p>
<p>​    R2(config)#access-list 100 deny   ip host  192.168.1.1 host 192.168.2.3</p>
<p>​    R2(config)#access-list 100 permit icmp host 192.168.1.1 host 192.168.2.1 </p>
<p>​    R2(config)#access-list 100 deny   icmp host 192.168.1.1 host 192.168.2.2</p>
<p>​    R2(config)#access-list 100 permit tcp host 192.168.1.2 host 12.1.1.2 eq telnet</p>
<p>​    interface Serial0/2/0</p>
<p>​    ip address 12.1.1.2 255.255.255.252           //配置IP</p>
<p>​    encapsulation ppp                                   //设置封装格式</p>
<p>​    ip access-group 100 in                                   //应用到接口</p>
<p>​    clock rate 4000000                                       //设置时钟频率，给客户端分配的带宽</p>
<p>​    检查命令：show   access-lists                          //检查ACL的匹配情况</p>
<p>​    </p>
<p>​    如果删除某条ACL，就要使用命名ACL的规则：</p>
<p>​        全部删除：no access-list 100</p>
<p>​        部分删除：</p>
<p>​    R2(config)#ip access-list extended 100   //extended表示修改扩展ACL，编号为100</p>
<p>​    R2(config-ext-nacl)#no 80            //删除ACL条目编号为80</p>
<p>​    补充特殊的ACL：FTP的被动模式</p>
<p>​    access-list 100 permit tcp host 192.168.1.2 host 192.168.2.3 eq ftp   //放行192.168.1.2到   </p>
<p>​    192.168.2.3的TCP-21，FTP控制连接</p>
<p>​    access-list 100 permit tcp host 192.168.1.2 host 192.168.2.3 range 1024 65535        //放行   </p>
<p>​      数据连接，目标端口号为大于1024的范围</p>
<p>​    远程登录配置：</p>
<p>​    R2(config)#line vty 0 4                              #0表示第1个虚拟接口；4表示最多允许登录人数</p>
<p>​    R2(config)#password 123456</p>
<p>​    R2(config)#login</p>
<p>​    ***R2(config)#enable password 123456   #password表示的明文密码</p>
<p>​    ***R2(config)#enable secret  123456        #secret表示密文的密码；如果两个都存在，那么密文</p>
<p>​    生效</p>
<p>3.常见服务和端口的对应关系</p>
<p>​    UDP服务：DHCP（udp-67,68）、DNS（udp-53）、NTP（udp-123，用于linux中的时间同  </p>
<p>​     步），TFTP（udp-69）</p>
<p>​    TCP服务：       </p>
<p>​    FTP(tcp-21:建立连接 和 tcp-20:传输数据)</p>
<p>​    http（tcp-80）；https（tcp-443）</p>
<p>​    远程桌面RDP（tcp-3389）</p>
<p>​    Telnet（tcp-23）</p>
<p>​    MySQL（tcp-3306）</p>
<p>​    ssh（tcp-22）</p>
<p>​    SMTP（tcp-25）</p>
<p>​    POP3（tcp-110）</p>
<p>​    共享（tcp-445）</p>
<p>1.NAT(Network  Address  Translation)：网络地址转换，用来把私网地址转换为公网地址。</p>
<p>  NAT的作用：实现地址转换；实现内外网隔离；节约了IP地址；把IPV4转换为IPv6.</p>
<p>2.NAT的工作原理：</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CLocal%5CYNote%5Cdata%5C2693615777@qq.com%5Caa51f215e9e140fa94e11135a7af4716%5Cnat%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png" alt="img"></p>
<p>3.NAT的配置步骤 ：</p>
<p>  第一步：先定义内外网接口（R1是出口路由器）</p>
<p>​    R1(config)#int f0/0</p>
<p>​    R1(config-if)#ip nat inside   （内网接口）</p>
<p>​    R1(config-if)#int f0/1</p>
<p>​    R1(config-if)#ip nat outside （外网接口）</p>
<p>  第二步：定义上网的网段</p>
<p>​    R1(config)#access-list 10 permit 192.168.1.0 0.0.0.255（0为精准，1为模糊）</p>
<p>  第三步：把私网地址转换为公网地址</p>
<p>​    R1(config)#ip nat inside source list 10 interface f0/1 overload </p>
<p>  检查命令： </p>
<p>​    R1#show ip nat translations      //显示nat转换记录</p>
<p>​    协议     公网地址          私网地址            公网的目标地址</p>
<p>​    Pro      Inside global     Inside local       Outside local      Outside global</p>
<p>​    icmp     12.1.1.1:33       192.168.1.1:33     34.1.1.2:33        34.1.1.2:33</p>
<p>Destination host unreachable   //目标主机不可达，一般是路由问题；</p>
<p>ftp主被动模式：</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CLocal%5CYNote%5Cdata%5C2693615777@qq.com%5C092e47792efe46ee9590c11aea418259%5Cftp%E7%9A%84%E4%B8%BB%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F.png" alt="img"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础十/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础十/" itemprop="url">网络基础十</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:56:03+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-10HSRP"><a href="#1-10HSRP" class="headerlink" title="1.10HSRP"></a>1.10HSRP</h1><p>1.HSRP（Hot Standby Routing  Protocol）：热备份路由协议，解决的是网关的冗余问题。</p>
<p>  HSRP是Cisco的私有协议，公有协议是VRRP。</p>
<p>2.HSRP中的路由器角色</p>
<p>  （1）Active：主路由器，第一个功能是负责转发客户端的流量；第二个功能是定期向外发送hello包。（需要设置抢占，抢占设置优先级）</p>
<p>  （2）Standby：备份路由器，如果主路由器发生故障，要接替主路由器的工作，负责转发用户的数据。</p>
<p>​                作用：监听主路由器的状态；定期向外发送hello。</p>
<p>  （3）Virtual Router 虚拟路由器:真实路由器逻辑上模拟出来的路由器，使用IP作为客户端的网关。</p>
<p>  （4）其他路由器:当备份顶替主路由器时，顶替备份路由器来工作  </p>
<p>3.HSRP中的角色选举依据；先比优先级大的，优先级相同再比ip地址大的</p>
<p>   （1）优先级可以人工干预设置，默认优先级是100，取值范围是0-255</p>
<p>   （2）优先级相同，比较IP</p>
<p>4.HSRP的工作原理：</p>
<p>   （1）所有路由器中选举一个Active，负责转发用户流量；并向外发送hello</p>
<p>   （2）当活跃路由器故障后，备份路由器监听不到活跃路由器的hello消息后会成为活跃路由器，承</p>
<p>​            担活跃路由器转发到虚拟路由器的数据包；  </p>
<p>   （3）然后其他路由器收不到备份路由器的hello消息，他们会从其他路由器中选举出一个新的备份</p>
<p>​           路由器。</p>
<p>5.HSRP的mac地址说明：</p>
<p>  0000.0c07.ac2f  其中0000.0c表示厂商信息，07.ac是众所周期的mac；2f表示HSRP的组号</p>
<p>6.HSRP的基本配置：</p>
<p>  主路由器的配置；</p>
<p>  interface FastEthernet0/0</p>
<p>​     ip address 192.168.1.100 255.255.255.0    //物理接口的IP</p>
<p>​     standby version 2            //HSRP的版本号，默认是版本2；默认不需要配置</p>
<p>​     standby 1 ip 192.168.1.254        //配置虚拟的网关Ip</p>
<p>​     standby 1 timers 3 10        //设置Hellotime为3秒，Holdtime为10秒，默认即为该值</p>
<p>​     standby 1 priority 105            //调整接口的优先级为105，默认优先级为100，（优先级选  </p>
<p>​     择范围100—110）</p>
<p>​     standby 1 preempt                //开启抢占，主发生故障再恢复以后，把状态抢回来。</p>
<p>​     standby 1 track FastEthernet0/0    //设置接口追踪</p>
<p>​     standby 1 track FastEthernet0/1   </p>
<p>  备份路由器的配置：</p>
<p>  interface FastEthernet0/0</p>
<p>​     ip address 192.168.1.200 255.255.255.0</p>
<p>​     standby version 2</p>
<p>​     standby 1 ip 192.168.1.254</p>
<p>​     standby 1 track FastEthernet0/1</p>
<p>​     standby 1 track FastEthernet0/0</p>
<p>  检查命令：</p>
<p>  R2#show standby brief   //查看HSRP（Host Standby Routing Protocol）的简要信息</p>
<p>​     Interface   Grp  Pri P State    Active          Standby         Virtual IP</p>
<p>​     Fa0/0       1    90    Standby  192.168.1.100   local           192.168.1.254 </p>
<p>​    本地启用HSRP的接口；Group表示组；State 表示本地的状态；Active表示活跃路由器的IP；Virtual Ip是虚拟的客户端的网关</p>
<p>  R2#show standby </p>
<p>​    FastEthernet0/0 - Group 1 (version 2)    //启用HSRP的接口是f0/0，组号为1，版本号为2</p>
<p>​    State is Standby            //本地的状态为Standby</p>
<p>​    9 state changes, last state change 00:49:15</p>
<p>​     Virtual IP address is 192.168.1.254   //虚拟的网关Ip</p>
<p>​     Active virtual MAC address is 0000.0C9F.F001            //虚拟的网关mac</p>
<p>​     Local virtual MAC address is 0000.0C9F.F001 (v2 default)</p>
<p>​    Hello time 3 sec, hold time 10 sec          //hello时间</p>
<p>​    Next hello sent in 2.011 secs</p>
<p>​    Preemption disabled                //抢占是关闭</p>
<p>​    Active router is 192.168.1.100, priority 90 (expires in 6 sec)        //活跃路由器的IP是  </p>
<p>​    192.168.1.100，优先级为90</p>
<p>​    MAC address is 0000.0C9F.F001     //活跃路由器的mac地址</p>
<p>​    Standby router is local            //本地是standby</p>
<p>​     Priority 90 (default 100)            //本地的优先级为90，默认是100</p>
<p>​    Track interface FastEthernet0/1 state Up decrement 10        //默认追踪接口故障，“罚值”是10，如果接口故障，优先级降低10.</p>
<p>​     Track interface FastEthernet0/0 state Up decrement 10</p>
<p>​     Group name is hsrp-Fa0/0-1 (default)        </p>
<p>7.配置思路：</p>
<p>  （1）配置PC的ip和网关</p>
<p>  （2）给交换机划分vlan</p>
<p>​        int  f0/1  （下）</p>
<p>​        swi  mode  access </p>
<p>​        swi  acc vlan  10</p>
<p>​        int  f0/5    （上）</p>
<p>​        sw   mode  trunk </p>
<p>​        sw   trunk  allow vlan all </p>
<p>​    （3）在网关路由器上的子接口上配置HSRP协议，虚拟出来不同vlan的网关</p>
<p>​        interface FastEthernet0/0.10             //让这个路由器的子接口成为vlan10的Active</p>
<p>​        encapsulation dot1Q 10</p>
<p>​        ip address 192.168.10.100 255.255.255.0</p>
<p>​        standby version 2</p>
<p>​        standby 10 ip 192.168.10.254</p>
<p>​        standby 10 priority 105</p>
<p>​        standby 10 preempt</p>
<p>​        standby 10 track FastEthernet0/0</p>
<p>​        standby 10 track FastEthernet0/1</p>
<p>​        interface FastEthernet0/0.20        //让这个路由器的子接口成为vlan20的Standby</p>
<p>​        encapsulation dot1Q 20</p>
<p>​        ip address 192.168.20.100 255.255.255.0</p>
<p>​        standby version 2</p>
<p>​        standby 20 ip 192.168.20.254</p>
<p>​        standby 20 preempt</p>
<p>​        standby 20 track FastEthernet0/0</p>
<p>​        standby 20 track FastEthernet0/1</p>
<p>  （4）在网关路由器上配置其他接口的IP和路由问题</p>
<p>​        ip route 0.0.0.0 0.0.0.0 192.168.100.1 </p>
<p>​        ip route 0.0.0.0 0.0.0.0 192.168.150.2 </p>
<p>  （5）在出口路由器配置Ip，解决2个路由问题————一个是到达内网的路由问题；一个是到达外 </p>
<p>​           网的路由问题。</p>
<p>​       ip route 192.168.10.0 255.255.255.0 192.168.100.2 </p>
<p>​       ip route 192.168.20.0 255.255.255.0 192.168.100.2 </p>
<p>​       ip route 192.168.10.0 255.255.255.0 192.168.200.2 </p>
<p>​       ip route 192.168.20.0 255.255.255.0 192.168.200.2 </p>
<p>​       ip route 0.0.0.0 0.0.0.0 12.1.1.2 </p>
<p>​        </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础九/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础九/" itemprop="url">网络基础九</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:55:35+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-9STP及STP的选举"><a href="#1-9STP及STP的选举" class="headerlink" title="1.9STP及STP的选举"></a>1.9STP及STP的选举</h1><p>1.STP的作用和版本</p>
<p>  （1）作用：二层的防环机制</p>
<p>  （2）版本：</p>
<p>​       STP：生成树协议，只有1棵树——————&gt;PVST（每vlan每生成树，Cisco私有协议）</p>
<p>​       RSTP：快速生成树协议，只有1棵树——————&gt;Rapid PVST（快速每vlan每生成树，</p>
<p>​           Cisco的私有协议）</p>
<p>​       MST：多实例生成树，可以基于实例（组）对根桥进行选举。</p>
<p>2.STP的三步选举：比较小的。</p>
<p>  （1）第一步：选举根桥（Root Bridge：皇帝）</p>
<p>  （2）第二步：选举根端口（Root port：知府）RP</p>
<p>  （3）第三步：选举指定端口（Designated Port：钦差）DP</p>
<p>3.第一步选举：在所有的交换机中选举一个根桥</p>
<p>   选举依据：网桥ID=2Byte（优先级）+6Byte（mac地址）   </p>
<p>   一般会通过优先级来控制根桥的选举。</p>
<p>4.第二步选举：在每个非根桥上选举一个根端口（Root Port）</p>
<p>  选择根端口的依据：</p>
<p>  到根网桥最低的根路径成本（开销，到达根桥最近）</p>
<p>  直连的网桥ID最小(发送者)</p>
<p>  端口ID最小（发送者）</p>
<p>5.第三步选举：在每条链路上选举一个指定端口（DP）</p>
<p>   根桥上的所有接口都是指定端口</p>
<p>   非根桥上的指定端口，选择顺序：</p>
<p>   端口所在交换机到达根路径成本较低</p>
<p>   本端交换机网桥ID较小</p>
<p>   本端的端口ID的值较小</p>
<p>6.STP的其他知识</p>
<p>  （1）STP通过BPDU（桥协议数据单元）来交互报文信息。</p>
<p>​       BPDU分为两大类：一类是“配置BPDU”用来完成STP的选举；另一种是拓扑变更TCP的</p>
<p>​       BPDU，当拓扑发生改变的时候交互信息。</p>
<p>  （2）STP中的几种状态：</p>
<p>​       Disabled：禁用状态</p>
<p>​       Blocking：阻塞状态，不能收发用户数据，只能接收BPDU（时刻监听网络的状态）</p>
<p>​       Listening：用来选举</p>
<p>​       Learning：用于学习mac地址</p>
<p>​       Forwarding：收发用户数据</p>
<p>  （3）STP中的状态切换时间</p>
<p>​       Listening—&gt;learning—&gt;Forwarding 经过了30s：PC接入网络的时间</p>
<p>​       Blocking—&gt;Listening—&gt;learning—&gt;Forwarding 经过50s     </p>
<p>7.STP的相关命令</p>
<p>  show  spanning-tree     //查看生成树的收敛结果</p>
<p>  3L-1#  show spanning-tree vlan 10      //查看STP的接口状态命令 </p>
<p>  spanning-tree   vlan 10 root primary    //让本交换机成为vlan10的主根桥</p>
<p>  spanning-tree   vlan 20 root secondary //让本交换机成为vlan20的备份根桥</p>
<p>  spanning-tree   vlan  10   priority   4096   //调整交换机在vlan10里的优先级为4096，值必须是4096 </p>
<p>  的倍数</p>
<p>  spanning-tree vlan 10,20,30 priority 24576   //如果一个交换机设置为root  primary会自动降低  </p>
<p>  8192；</p>
<p>  spanning-tree vlan 40,50,60 priority 28672   //如果一个交换机设置为root  secondary会降低4096</p>
<p>  Switch(config)#int   f0/1              //默认情况下，PC接入网络中需要等待30s的延迟（STP的收</p>
<p>  敛），为了加快时间的收敛，启用portfast。</p>
<p>  Switch(config-if)#spanning-tree portfast    //启用portfast以后，接口不再等待30s的STP报文交互，</p>
<p>  直接进入到Forwarding状态</p>
<p>8.基础命令</p>
<p>  （1）配置vlan命令</p>
<p>​    interface FastEthernet0/3        //把接口加入到vlan30</p>
<p>​    switchport access vlan 30</p>
<p>​    switchport mode access</p>
<p>​    interface FastEthernet0/4        //把接口设置为trunk</p>
<p>​    switchport mode trunk</p>
<p>​    show  vlan   brief     //检查接口和vlan是否对应</p>
<p>​    show  int   trunk     //检查trunk链路是否正常</p>
<p>  （2）三层交换机上下联接口使用trunk</p>
<p>​     interface range  FastEthernet0/1 - 3</p>
<p>​     switchport trunk encapsulation dot1q           </p>
<p>​     switchport mode trunk</p>
<p>​    3L-1(config)#spanning-tree vlan 10,20,30 root primary       //交换机做vlan10/20/30的主根桥</p>
<p>​    3L-1(config)#spanning-tree vlan 40,50,60 root secondary    //交换机做vlan40/50/60备份根桥</p>
<p>​    3L-2(config)#spanning-tree vlan 40,50,60 root primary </p>
<p>​    3L-2(config)#spanning-tree vlan 10,20,30 root secondary </p>
<p>  （3）三层交换机上配置PC的网关</p>
<p>​    3L-2(config)#int vlan 50</p>
<p>​    3L-2(config-if)#ip add 192.168.50.254 255.255.255.0</p>
<p>​    3L-2(config-if)#no sh</p>
<p>​    3L-2(config)#ip  routing   </p>
<p>  （4）配置回环口：</p>
<p>​       interface Loopback0</p>
<p>​       ip address 11.1.1.1 255.255.255.0</p>
<p>  特别说明：做实验的时候，先把内网做通！！！</p>
<p>  三层交换机上要有默认路由到出口路由器；出口路由器要有到达内网的路由。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="blog.shenzihao.top/2019/10/25/网络基础八/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吕敏">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/1.jpg">
    </span>

     <span title="Words count in article">
      字
     </span>

        ...
     <span title="Reading time">
      分钟
     </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LvMin-Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/25/网络基础八/" itemprop="url">网络基础八</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-25T14:55:23+08:00">
                2019-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time </span>
                
                <span title="Reading time">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-8三层交换和DHCP"><a href="#1-8三层交换和DHCP" class="headerlink" title="1.8三层交换和DHCP"></a>1.8三层交换和DHCP</h1><p>1.交换机的工作原理是广播————&gt;划分广播域：vlan划分——————&gt;access和trunk————&gt;  </p>
<p>  不同vlan之间的通信——————&gt;单臂路由</p>
<p>  单臂路由：源目IP地址不变，mac地址被重写；实现标签置换。</p>
<p>  trunk链路的工作原理：发送的时候会给数据帧打上相应vlan的标签（802.1q数据帧）；接收的时候</p>
<p>  根据标签里的vlanID来识别来自哪个vlan。</p>
<p>  在出交换机的时候，去掉标签，还原成原始数据帧。</p>
<p>2.单臂路由带来的问题：</p>
<p>​    “单臂”为网络骨干链路，容易形成网络瓶颈</p>
<p>​    子接口依然依托于物理接口，应用不灵活</p>
<p>​    VLAN间转发需要查看路由表，严重浪费设备资源</p>
<p>3.常见的数据包交换方式：</p>
<p>​    （1）包交换：每个数据包在经过路由器的时候，都要查找路由表（通过CPU）。</p>
<p>​    （2）三层交换技术；</p>
<p>​         基于数据流来进行路由表的查找；</p>
<p>​         查找完了以后，会在本地的ASIC芯片上做缓存，后续报文不再需要查路由表，直接查找缓</p>
<p>​                 存信息。</p>
<p>​        </p>
<p>​         五元组：源目IP、源目端口、协议。如果多个数据包的五元组一样，我们把他们都称为同</p>
<p>​                 一个“数据流”</p>
<p>​         七元组：源IP地址、目的IP地址、协议号、源端口、目的端口，服务类型以及接口索引</p>
<p>​    （3）CEF转发：基于拓扑的模型</p>
<p>​         FIB:转发信息表，路由表的download（复制了一份）</p>
<p>​         邻接关系表：ARP表。</p>
<p>4.三层交换机的工作原理：一次路由，多次交换。</p>
<p>  基本配置：</p>
<p>  （1）支持开启路由功能：ip  routing </p>
<p>  （2）把二层接口转换为3层接口，直接配置IP</p>
<p>​       int  f0/1</p>
<p>​       no   switchport       //关闭二层功能，转换为三层接口</p>
<p>​       ip   address   192.168.10.254  255.255.255.0</p>
<p>​       no   sh   </p>
<p>  （3）支持SVI（Switch  Virtual  Interface）交换虚接口</p>
<p>​      int  vlan  10</p>
<p>​       ip    add 192.168.10.254   255.255.255.0</p>
<p>​       no    sh  </p>
<p>5.实验说明：</p>
<p>  （1）配置PC</p>
<p>  （2）配置二层交换机：划分vlan和trunk</p>
<p>​              vlan 10</p>
<p>​              int f0/1</p>
<p>​              switchport mode access</p>
<p>​              switchport access vlan 10</p>
<p>​              switchport mode trunk</p>
<p>​              switchport trunk allowed vlan all</p>
<p>  （3）配置三层交换机：</p>
<p>​         第一步：把内网接口配置为trunk链路，并设置封格式为dot1q</p>
<p>​             interface FastEthernet0/1</p>
<p>​         switchport trunk encapsulation dot1q</p>
<p>​         switchport mode trunk</p>
<p>​        第二步：在交换虚接口里配置PC的网关</p>
<p>​        3L-1(config)#vlan  10   </p>
<p>​        3L-1(config)#int vlan 10</p>
<p>​        3L-1(config-if)#ip add 192.168.10.254 255.255.255.0</p>
<p>​        3L-1(config-if)#no sh    </p>
<p>​        第三步：配置外网接口</p>
<p>​        3L-1(config)#int f0/2</p>
<p>​        3L-1(config-if)#no switchport      </p>
<p>​        3L-1(config-if)#ip add 12.1.1.1 255.255.255.0</p>
<p>​        3L-1(config-if)#no sh</p>
<p>​        第四步：开启路由功能</p>
<p>​        ip  routing   </p>
<p>1.DHCP(Dynamic Host  Configuration Protocol)动态主机配置协议，用来给客户端分配IP、子网、网关、DNS等。</p>
<p>  DHCP使用的是UDP 67,68端口。</p>
<p>  作用域：给客户端分配的网段。192.168.1.0/24</p>
<p>  地址池：给客户端分配IP的范围。192.168.1.1——192.168.1.50 </p>
<p>  保留地址：让某一个客户端总是获取相同的Ip。</p>
<p>  排除地址：不给客户端分配的IP</p>
<p>2.DHCP的配置：</p>
<p>  R1(config)#do show run | s dhcp </p>
<p>​    ip dhcp pool vlan10                                                //启用地址池，名字叫vlan10</p>
<p>​    network 192.168.10.0 255.255.255.0                        //配置作用域为192.168.10.0/24</p>
<p>​        dns-server 114.114.114.114                                    //给客户端使用的DNS</p>
<p>​    default-router 192.168.10.254                            //给客户端使用的默认网关</p>
<p>​        ip dhcp excluded-address 192.168.10.254                     //排除网关IP</p>
<p>​        ip dhcp excluded-address 192.168.10.1 192.168.10.9   //排除一个范围(可排除亦可不排除)</p>
<p>​    </p>
<p>3.DHCP的4种常见报文：客户端找服务器的时候是2个广播报文；服务器回复的时候是2个单播报文。</p>
<p> （1）Discover：发现报文，用来寻找网络中的DHCP服务器。</p>
<p>​          Source :        0.0.0.0                PC的mac地址为源</p>
<p>​          Destination:  255.255.255.255              全FFFF</p>
<p> （2）Offer：提供报文，是DHCP从自己的地址池中选择一个IP地址，分配给客户端。</p>
<p> （3）Request：请求报文，告诉网络中的其他DHCP服务器“不用再给我分配IP了”；防止IP地址冲</p>
<p>​          突。</p>
<p> （4）Ack：确认报文，确认客户端的Ip地址等信息，确认租约时间。</p>
<p>4.当DHCP和客户端不在同一个网段的时候，需要配置DHCP中继代理。</p>
<p>  PC找DHCP的时候，是通过广播报文，应该在网关接口配置DHCP中继代理。</p>
<p>  int  vlan  10</p>
<p>  ip    add 192.168.10.254  255.255.255.0</p>
<p>  ip    helper-address   192.168.50.1     //告诉网关，谁是DHCP服务器</p>
<p>​    </p>
<p>5.DHCP的中继代理配置步骤：先解决内网的通信问题。</p>
<p>  （1）在三层交换机的下行接口上划分vlan</p>
<p>  （2）在三层交换机的上行接口上启用三层接口，并配置Ip</p>
<p>  （3）在三层交换机上给PC配置网关</p>
<p>​        vlan  10</p>
<p>​        vlan  20</p>
<p>​        int   vlan 10</p>
<p>​        ip   address  192.168.10.254  255.255.255.0</p>
<p>​        no   sh</p>
<p>​        ip   helper-address    192.168.50.1     //配置DHCP中继代理，告诉客户端，谁是DHCP服务器</p>
<p>​            ip  routing  </p>
<p>​             ip  route  0.0.0.0 0.0.0.0  192.168.50.1</p>
<p>  （4）在出口路由器配置</p>
<p>​                第一步：配置接口IP</p>
<p>​        第二步：配置DHCP地址池</p>
<p>​        第三步：配置到达内网vlan的路由</p>
<p>​            </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>
<p>​    </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/1.jpg" alt="吕敏">
            
              <p class="site-author-name" itemprop="name">吕敏</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吕敏</span>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count"></span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>












        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
